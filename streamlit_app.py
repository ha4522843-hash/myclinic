import streamlit as st
import pandas as pd
from datetime import datetime

# --- 1. Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙˆØ§Ù„Ø°ÙƒØ§Ø¡ Ø§Ù„Ø¨ØµØ±ÙŠ ---
st.set_page_config(page_title="Clinic_DB | Dr. Hagar", layout="wide")

# Ø¯Ø§Ù„Ø© Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ø³Ù† ÙˆØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
def get_age_details(dob):
    today = datetime.today()
    years = today.year - dob.year
    months = today.month - dob.month
    days = today.day - dob.day
    if days < 0: months -= 1
    if months < 0: years -= 1; months += 12
    
    # ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ÙØ¦Ø© Ø§Ù„Ø¹Ù…Ø±ÙŠØ©
    if years < 12: icon = "ðŸ‘¶ (Ø·ÙÙ„)"
    elif years < 18: icon = "ðŸ‘¦/ðŸ‘§ (Ù…Ø±Ø§Ù‡Ù‚)"
    else: icon = "ðŸ‘¨/ðŸ‘© (Ø¨Ø§Ù„Øº)"
    
    return f"{years} Ø³Ù†Ø©ØŒ {months} Ø´Ù‡Ø±ØŒ {0 if days < 0 else days} ÙŠÙˆÙ…", icon

# --- 2. Ù…Ø­Ø±Ùƒ Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø°ÙƒÙŠØ© (Ø§Ù„ØªÙŠ ØªØªØ¹Ù„Ù…) ---
# ØªÙˆØ¶ÙŠØ­: Ù‡Ø°Ù‡ Ø§Ù„Ø¯Ø§Ù„Ø© ØªØ¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø´ÙŠØª ÙˆØªØ¶ÙŠÙ Ø¹Ù„ÙŠÙ‡Ø§ Ø£ÙŠ "Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠ" Ø¬Ø¯ÙŠØ¯Ø© Ù„ØªØ¸Ù‡Ø± Ù„Ù„ÙƒÙ„
def get_dynamic_list(column_name, default_list):
    # Ù‡Ù†Ø§ Ø§Ù„ÙƒÙˆØ¯ Ø¨ÙŠÙ‚Ø±Ø£ Ù…Ù† Clinic_DB Ø§Ù„Ù‚ÙŠÙ… Ø§Ù„ÙØ±ÙŠØ¯Ø© (Unique) Ø§Ù„Ù„ÙŠ Ø§ØªØ³Ø¬Ù„Øª Ù‚Ø¨Ù„ ÙƒØ¯Ø©
    # ÙˆÙŠØ¶ÙŠÙÙ‡Ø§ Ù„Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© Ø¹Ø´Ø§Ù† ØªØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ø§Ø®ØªÙŠØ§Ø±Ø§Øª Ù„Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ù„ÙŠ Ø¨Ø¹Ø¯ ÙƒØ¯Ø©
    return default_list # (Ø³ÙŠØªÙ… Ø±Ø¨Ø·Ù‡Ø§ Ø¨Ø±Ù…Ø¬ÙŠØ§Ù‹ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ø§Ø­Ù‚Ø§Ù‹)

# --- 3. Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© (Sidebar) ---
st.sidebar.title("ðŸ¥ Ø¹ÙŠØ§Ø¯Ø© Ø¯. Ù‡Ø§Ø¬Ø±")
role = st.sidebar.radio("Ø§Ù„Ø§Ù†ØªÙ‚Ø§Ù„ Ø¥Ù„Ù‰:", ["ðŸ“Š Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„", "ðŸ©º Ø§Ù„Ø¬Ø±Ø§Ø­ ÙˆØ§Ù„Ù‚Ø±Ø§Ø±", "ðŸ•µï¸ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙˆØ§Ù„Ø£Ø±Ø´ÙŠÙ"])

# --- 4. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ (Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø©) ---
if role == "ðŸ“Š Ø§Ù„Ø§Ø³ØªÙ‚Ø¨Ø§Ù„":
    st.header("ØªØ³Ø¬ÙŠÙ„ ÙˆØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø±ÙŠØ¶")
    
    # Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù†ÙˆØ¹ Ø¨Ø£Ø²Ø±Ø§Ø± ØªÙØ§Ø¹Ù„ÙŠØ©
    st.write("Ø§Ù„Ù†ÙˆØ¹:")
    col_m, col_f = st.columns(2)
    gender = "Ø°ÙƒØ±" if col_m.button("â™‚ï¸ Ø°ÙƒØ±", use_container_width=True) else "Ø£Ù†Ø«Ù‰"
    
    # Ù…Ø­Ø±Ùƒ Ø§Ù„Ø³Ù† ÙˆØ§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø§Øª
    dob = st.date_input("ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯:", value=datetime(1995, 1, 1))
    age_str, age_icon = get_age_details(dob)
    st.info(f"Ø§Ù„Ø³Ù†: {age_str} | Ø§Ù„ÙØ¦Ø©: {age_icon}")

    # Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„ØªÙŠ ØªØªØ¹Ù„Ù… (Ø§Ù„Ù…Ù‡Ù†ØŒ Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ØŒ Ø§Ù„Ù…ØµØ¯Ù‘Ø±)
    job_list = ["Ù…ÙˆØ¸Ù", "Ø·Ø§Ù„Ø¨", "Ø±Ø¨Ø© Ù…Ù†Ø²Ù„", "Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø© âž•"]
    selected_job = st.selectbox("Ø§Ù„Ù…Ù‡Ù†Ø©:", job_list)
    if selected_job == "Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø© âž•":
        new_job = st.text_input("Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ù‡Ù†Ø© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ù‡Ù†Ø§ (Ø³ØªÙØ­ÙØ¸ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©):")

    # Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø²Ù…Ù†Ø© (Multi-select + Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠ)
    chronic_list = ["Ø³ÙƒØ±", "Ø¶ØºØ·", "ØºØ¯Ø©", "Ù‚Ù„Ø¨", "Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø¶ Ø¬Ø¯ÙŠØ¯ âž•"]
    diseases = st.multiselect("Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø²Ù…Ù†Ø©:", chronic_list)
    if "Ø¥Ø¶Ø§ÙØ© Ù…Ø±Ø¶ Ø¬Ø¯ÙŠØ¯ âž•" in diseases:
        new_dis = st.text_input("Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø±Ø¶ Ø§Ù„Ø¬Ø¯ÙŠØ¯ (Ø³ÙŠØ¸Ù‡Ø± Ù„ÙƒÙ„ Ø§Ù„Ù…Ø±Ø¶Ù‰ Ù„Ø§Ø­Ù‚Ø§Ù‹):")

    # Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© (Ø­ØªÙ‰ Ù„Ùˆ Ù…Ø¹ Ø¬Ø±Ø§Ø­ Ø¢Ø®Ø±)
    prev_ops_list = ["ØªÙƒÙ…ÙŠÙ…", "Ù…Ø±Ø§Ø±Ø©", "ÙØªÙ‚ Ø¥Ø±Ø¨ÙŠ", "Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø³Ø§Ø¨Ù‚Ø© âž•"]
    p_ops = st.multiselect("Ø¹Ù…Ù„ÙŠØ§Øª Ø³Ø§Ø¨Ù‚Ø©:", prev_ops_list)
    if "Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø³Ø§Ø¨Ù‚Ø© âž•" in p_ops:
        new_p_op = st.text_input("Ø³Ø¬Ù„ Ø¹Ù…Ù„ÙŠØ© Ø£Ø¬Ø±Ø§Ù‡Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø³Ø§Ø¨Ù‚Ø§Ù‹ (ØªÙØ­ÙØ¸ ÙÙŠ Ø§Ù„Ø£Ø±Ø´ÙŠÙ):")

    if st.button("Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ðŸ’¾"):
        st.success("ØªÙ… Ø§Ù„Ø­ÙØ¸ ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„Ù‚ÙˆØ§Ø¦Ù… Ø§Ù„Ø°ÙƒÙŠØ© Ù„Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†!")

# --- 5. ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¬Ø±Ø§Ø­ (Ø§Ù„Ù‚Ø±Ø§Ø± ÙˆØ§Ù„Ø¹Ù…Ù„ÙŠØ§Øª) ---
elif role == "ðŸ©º Ø§Ù„Ø¬Ø±Ø§Ø­ ÙˆØ§Ù„Ù‚Ø±Ø§Ø±":
    st.header("ðŸ©º Ù„ÙˆØ­Ø© Ø§ØªØ®Ø§Ø° Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø¬Ø±Ø§Ø­ÙŠ")
    
    # Ù…Ø±Ø¨Ø¹ Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„ÙƒØ¨ÙŠØ±
    decision = st.selectbox("ðŸŽ¯ Ø§Ù„Ù‚Ø±Ø§Ø± Ø§Ù„Ø·Ø¨ÙŠ:", ["Ø¹Ù„Ø§Ø¬ ÙÙ‚Ø·", "Ø¹Ù„Ø§Ø¬ ÙˆÙ…ØªØ§Ø¨Ø¹Ø©", "ØªØ­Ø¯ÙŠØ¯ Ø¹Ù…Ù„ÙŠØ©"])
    
    if decision == "ØªØ­Ø¯ÙŠØ¯ Ø¹Ù…Ù„ÙŠØ©":
        dept = st.selectbox("ðŸ“‚ Ø§Ù„Ù‚Ø³Ù…:", ["Ø¬Ø±Ø§Ø­Ø© Ø³Ù…Ù†Ø©", "Ù…Ù†Ø§Ø¸ÙŠØ±", "Ø¬Ø±Ø§Ø­Ø© Ø¹Ø§Ù…Ø©"])
        
        # Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª (ØªØªØ¹Ù„Ù… Ø£ÙŠØ¶Ø§Ù‹)
        ops_list = ["ØªÙƒÙ…ÙŠÙ…", "ØªØ­ÙˆÙŠÙ„ Ù…Ø³Ø§Ø±", "Ø³Ø§Ø³ÙŠ", "Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø£Ø®Ø±Ù‰ âž•"]
        selected_op = st.selectbox("âœ‚ï¸ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©:", ops_list)
        if selected_op == "Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ÙŠØ© Ø£Ø®Ø±Ù‰ âž•":
            custom_op = st.text_input("Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© (Ø³ÙŠÙØ­ÙØ¸ ÙƒØ®ÙŠØ§Ø± Ø¬Ø§Ù‡Ø² Ø¨Ø¹Ø¯ ÙƒØ¯Ø©):")

        # Ù…Ø­Ø±Ùƒ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ (Ø­Ø°Ù ÙˆØ¥Ø¶Ø§ÙØ©)
        st.subheader("ðŸ§ª Ø¨Ø±ÙˆØªÙˆÙƒÙˆÙ„ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„")
        labs = ["ØµÙˆØ±Ø© Ø¯Ù…", "ÙˆØ¸Ø§Ø¦Ù ÙƒØ¨Ø¯", "Ø³ÙŠÙˆÙ„Ø©", "Ø³ÙƒØ± ØªØ±Ø§ÙƒÙ…ÙŠ"]
        final_selected_labs = []
        c1, c2 = st.columns(2)
        for i, lab in enumerate(labs):
            if (c1 if i%2==0 else c2).checkbox(lab, value=True):
                final_selected_labs.append(lab)
        
        extra_lab = st.text_input("âž• Ø¥Ø¶Ø§ÙØ© ØªØ­Ù„ÙŠÙ„/Ø¥Ø´Ø§Ø¹Ø© Ø®Ø§ØµØ© Ù„Ù‡Ø°Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶ (Ø³ØªÙØ­ÙØ¸ ÙÙŠ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø©):")

    if st.button("Ø§Ø¹ØªÙ…Ø§Ø¯ Ø§Ù„Ù‚Ø±Ø§Ø± âœ‰ï¸"):
        st.balloons()
        st.write("ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„ØªØ­Ø§Ù„ÙŠÙ„ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ù‚Ø±Ø§Ø± Ø¥Ù„Ù‰ Ø§Ù„Ù…Ø±ÙŠØ¶.")

# --- 6. Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙˆØ§Ù„Ø£Ø±Ø´ÙŠÙ ---
elif role == "ðŸ•µï¸ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙˆØ§Ù„Ø£Ø±Ø´ÙŠÙ":
    st.header("ðŸ•µï¸ Ø³Ø¬Ù„ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø© ÙˆØ§Ù„Ø¨Ø­Ø« (Ù„Ù„Ø¯ÙƒØªÙˆØ±Ø© ÙÙ‚Ø·)")
    st.write("ÙƒÙ„ Ø­Ø±ÙƒØ© (Ø¥Ø¶Ø§ÙØ© ÙŠØ¯ÙˆÙŠ Ø£Ùˆ ØªØ¹Ø¯ÙŠÙ„) Ù…Ø³Ø¬Ù„Ø© Ù‡Ù†Ø§ Ø¨Ø§Ù„Ø«Ø§Ù†ÙŠØ©:")
    
    # Ù…Ø«Ø§Ù„ Ù„Ø´ÙƒÙ„ Ø§Ù„Ø±Ù‚Ø§Ø¨Ø©
    audit_data = pd.DataFrame({
        "Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…": ["Ø§Ù„Ø³ÙƒØ±ØªÙŠØ±Ø©", "Ø¯. Ù‡Ø§Ø¬Ø±"],
        "Ø§Ù„ÙØ¹Ù„": ["Ø¥Ø¶Ø§ÙØ© Ù…Ù‡Ù†Ø© Ø¬Ø¯ÙŠØ¯Ø© (Ø·ÙŠØ§Ø±)", "Ø¥Ø¶Ø§ÙØ© ØªØ­Ù„ÙŠÙ„ (Ø±Ù†ÙŠÙ† Ù…ØºÙ†Ø§Ø·ÙŠØ³ÙŠ)"],
        "Ø§Ù„ÙˆÙ‚Øª": ["10:30:15 PM", "11:15:00 PM"]
    })
    st.table(audit_data)
